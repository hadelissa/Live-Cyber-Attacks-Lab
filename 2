# Azure Sentinel Live RDP Attacks Home Lab

## Description
This lab demonstrates how to configure Azure Sentinel SIEM linked to a virtual machine set up as a honeypot to monitor RDP brute force attacks from worldwide sources. It includes a PowerShell script that extracts failed RDP login attempts, retrieves attacker geolocation data, and visualizes it on an Azure Sentinel map.

---

## Technologies & Tools Used

- **PowerShell:** Extract failed RDP login events from Windows Event Viewer  
- **ipgeolocation.io:** IP to Geolocation API  
- **Azure:** Virtual Machine, Log Analytics Workspace, Microsoft Sentinel SIEM  
- **Windows 10:** Remote Desktop Connection

---

## Lab Overview

1. **Create an Azure Virtual Machine (VM)**  
   - VM configured as a honeypot with firewall disabled to allow RDP brute force attacks  
   - VM exposed to the internet to attract attackers  
   - ![VM Creation](https://i.imgur.com/tnZFnRF.png)  
   - ![Create Button](https://i.imgur.com/tnZFnRF.png)  
   - ![New Resource Group](https://i.imgur.com/ynBscZY.png)  
   - ![Admin Settings](https://i.imgur.com/CAqCmXi.png)  
   - ![NIC Network Security](https://i.imgur.com/h7NKkVC.png)  
   - ![Firewall Rule](https://i.imgur.com/eRvMwtq.png)  
   - ![Review + Create](https://i.imgur.com/95DofSd.png)  

2. **Set up Log Analytics Workspace**  
   - Collect and analyze security logs with geographic data  
   - ![Log Analytics Workspace](https://i.imgur.com/w3GVvTj.png)  
   - ![Create Workspace](https://i.imgur.com/FWCKVF7.png)  
   - ![Configure Workspace](https://i.imgur.com/rdDMgyn.png)  
   - ![Review Workspace](https://i.imgur.com/6bLO9kL.png)  

3. **Enable Microsoft Defender for Cloud**  
   - Integrate VM with Log Analytics to collect all security events  
   - ![Microsoft Defender Search](https://i.imgur.com/TzxwwlW.png)  
   - ![Environment Settings](https://i.imgur.com/hz9m1bU.png)  
   - ![Defender Configuration](https://i.imgur.com/hm6FZ9p.png)  
   - ![Data Collection](https://i.imgur.com/Brjfczf.png)  

4. **Connect VM to Log Analytics Workspace**  
   - Link VM for centralized log collection and analysis  
   - ![Log Analytics Workspaces](https://i.imgur.com/AGNakgg.png)  
   - ![Select VM](https://i.imgur.com/FDAWy61.png)  
   - ![Connect VM](https://i.imgur.com/fKHWoe0.png)  

5. **Configure Microsoft Sentinel**  
   - Use Sentinel for visualizing attack data and creating custom queries  
   - ![Microsoft Sentinel](https://i.imgur.com/HaGg6BJ.png)  
   - ![Select Workspace](https://i.imgur.com/mYLJIpM.png)  

6. **Remote Desktop Connection to VM**  
   - Access VM remotely, disable firewall for testing  
   - ![Public IP](https://i.imgur.com/RXEs5ZX.png)  
   - ![Remote Desktop Connection](https://i.imgur.com/vFZ1y8y.png)  
   - ![Firewall Properties](https://i.imgur.com/G0DciTe.png)  
   - ![Disable Firewall](https://i.imgur.com/7gc3gTp.png)  

7. **PowerShell Script for Failed RDP Log Extraction and Geolocation**  
   - Script parses security logs for failed login events, queries IP geolocation API, and creates geo-enriched logs  
   - ![PowerShell Script](https://i.imgur.com/qeXb3ku.png)  
   - ![API Key Setup](https://i.imgur.com/Njgs68Y.png)  
   - ![Run Script](https://i.imgur.com/3gLgDup.png)  
   - ![Log File Location](https://i.imgur.com/8UqFqfa.png)  

8. **Custom Log Integration in Log Analytics Workspace**  
   - Upload and configure failed RDP log file with geodata as a custom log  
   - Extract relevant fields for analysis  
   - ![Add Custom Log](https://i.imgur.com/Vui6hoA.png)  
   - ![Run Query](https://i.imgur.com/2gHs1Z1.png)  
   - ![Extract Fields](https://i.imgur.com/vchO4Op.png)  
   - ![Field Extraction Example 1](https://i.imgur.com/ipuwNdO.png)  
   - ![Field Extraction Example 2](https://i.imgur.com/B66k1eT.png)  

9. **Visualizing Live Attacks on a Map**  
   - Create a Microsoft Sentinel workbook with a map visualization of attack locations using geo-enriched logs  
   - ![Create Workbook & Query](https://i.imgur.com/BINQSdc.png)  
   - ![Map Settings](https://i.imgur.com/8dcLXal.png)  
   - ![Save Workbook](https://i.imgur.com/8yJn7Ev.png)  

---

## Results: Global Map of Attacks  
After running this lab for 24 hours, the map below shows live incoming attacks with geolocation data.

<p align="center">
  <img src="https://i.imgur.com/mPgDumR.png" alt="World map of incoming attacks" width="85%" height="85%"/>
</p>

---

## Notes  
- Azure subscription is required (free credits available for new accounts)  
- Firewall is disabled intentionally on VM to allow honeypot activity  
- PowerShell script requires API key from [ipgeolocation.io](https://ipgeolocation.io)

---

